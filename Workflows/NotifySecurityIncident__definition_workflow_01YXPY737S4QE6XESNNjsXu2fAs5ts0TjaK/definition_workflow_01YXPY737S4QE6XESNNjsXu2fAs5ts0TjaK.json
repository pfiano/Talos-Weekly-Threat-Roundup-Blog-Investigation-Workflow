{
  "workflow": {
    "unique_name": "definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK",
    "name": "Notify Security Incident",
    "title": "Notify Security Incident",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "domain reputations",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_0205WCM30BPN319iQJRIG5bdiMeLhZyAwGp",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "Umbrella OrgID",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01YXQ7HY2JZMO0ekSqQH4DKBWPZ6HCyIFwi",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "Amp email text",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "hostname",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_0229V8TOPM4FR1lGAXmKNMZnYGiw9U5MOmI",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "local",
          "name": "Umbrella email text",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01YYFAYZF69NA2jO5cHtX5h0RZWLfaVAnTV",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "Netanelz+beerireports@cybercom.co.il,oron@beeriprint.co.il,pfiano@cisco.com,raziel@beeriprint.co.il",
          "scope": "local",
          "name": "Email Notification",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_020BZIBRUUYV75gUcAktqDbOTeEiTCVCm1b",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.integer",
        "properties": {
          "value": 300,
          "scope": "local",
          "name": "Timeframe",
          "type": "datatype.integer",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_0229UFVCW7WC40IDxbUczlZaRFZLRvxxZxp",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "is_atomic": false
      },
      "delete_workflow_instance": false,
      "display_name": "Notify Security Incident",
      "runtime_user": {
        "target_default": true
      },
      "target": {
        "no_target": true
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01YYEDB3SFKWN7G4TbXK6urzPHhiErtqQtV",
        "name": "Parallel Block",
        "title": "Parallel Block",
        "type": "logic.parallel",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Parallel Block",
          "skip_execution": false
        },
        "object_type": "definition_activity",
        "blocks": [
          {
            "unique_name": "definition_activity_01YYEDB47C8D6504LpdLqVQWi5uoFpHrptj",
            "name": "Parallel Branch",
            "title": "AMP branch",
            "type": "logic.parallel_block",
            "base_type": "activity",
            "properties": {
              "continue_on_failure": false,
              "display_name": "AMP branch",
              "skip_execution": false
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01YYFT8S5UP6C2iNzlsAeRpRyPcsU59pTSZ",
                "name": "HTTP Request",
                "title": "Get AMP compromises",
                "type": "web-service.http_request",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "allow_auto_redirect": true,
                  "allow_headers_redirect": false,
                  "content_type": "application/json",
                  "continue_on_error_status_code": false,
                  "continue_on_failure": false,
                  "display_name": "Get AMP compromises",
                  "method": "GET",
                  "relative_url": "/compromises",
                  "runtime_user": {
                    "override_target_runtime_user": true,
                    "runtime_user_id": "definition_runtime_user_01YBMEWVFH0Q93mDQfgl3f3oc61RqNywZQg"
                  },
                  "skip_execution": false,
                  "target": {
                    "override_workflow_target": true,
                    "target_id": "definition_target_01YBMDAVR9SDI12rOOMmjJyTyWEVCvr4pOZ"
                  }
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01YYFUQXY1YCO18JpE7X0HCQwtxGYoBlxRt",
                "name": "Execute Python Script",
                "title": "Execute Python Script",
                "type": "python3.script",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "continue_on_failure": false,
                  "display_name": "Execute Python Script",
                  "script": "import json\nimport sys\nimport traceback\nfrom datetime import datetime\n\nTIMEFRAME = int(sys.argv[4])\n\ndef timestr_to_timestamp( timestr ):\n\n  if timestr[len(timestr)-1] == \"Z\":\n\t  timestr = timestr[:len(timestr)-1] + \"+00:00\"\n    \n  timestr = timestr.split(\"+\")\n  timestr = timestr[0] +\"+\" + timestr[1].replace(\":\", \"\")\n\n  datetime_object = datetime.strptime(timestr, '%Y-%m-%dT%H:%M:%S%z')\n\n  timestamp = datetime.timestamp(datetime_object)\n\n  return timestamp\n\ncompromises = {}\ncompromises[\"response\"] = sys.argv[1]\ncompromises[\"status_code\"] = sys.argv[2]\ncompromises[\"status_text\"]= sys.argv[3]\n\ndrop = True\namp_incidents = []\npc_compromessi = []\nemail_text = \"\"\n\ntry:\n  if compromises[\"status_code\"] != \"200\":\n    raise Exception(\"HTML Error!\")\n\n  response = json.loads(compromises[\"response\"])\n\n  if \"data\" in response:\n    response = response[\"data\"]\n\n  now = datetime.timestamp(datetime.now())\n\n  for incident in response:\n    keep = True\n    keep = keep and (\"status\" in incident) and (incident[\"status\"] != \"in_progress\")\n    if \"computer\" in incident:\n      keep = keep and (\"connector_guid\" in incident[\"computer\"])  \n      keep = keep and (incident[\"computer\"][\"connector_guid\"] not in pc_compromessi)\n    if \"created_at\" in incident:\n      created_at = timestr_to_timestamp( incident[\"created_at\"] )\n      keep = keep and (created_at \u003e now - TIMEFRAME)\n      \n    if keep:\n      pc_compromessi.append(incident[\"computer\"][\"connector_guid\"])\n      computer = incident[\"computer\"]\n      del incident[\"computer\"]\n      for k,v in computer.items():\n        incident[k] = v\n      amp_incidents.append(incident)\n\n  drop = len(amp_incidents) == 0\n  amp_incidents = json.dumps(amp_incidents)\n\nexcept Exception as Err:\n  text += f\"{traceback.format_exc()}\\n\"\n  text += \"\\n\"\n\n  for key, value in compromises.items():\n    text += f\"{key}: {json.dumps(value)}\\n\"\n\n  print(text)\n  drop = True",
                  "script_arguments": [
                    "$activity.definition_activity_01YYFT8S5UP6C2iNzlsAeRpRyPcsU59pTSZ.output.response_body$",
                    "$activity.definition_activity_01YYFT8S5UP6C2iNzlsAeRpRyPcsU59pTSZ.output.status_code$",
                    "$activity.definition_activity_01YYFT8S5UP6C2iNzlsAeRpRyPcsU59pTSZ.output.status_text$",
                    "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0229UFVCW7WC40IDxbUczlZaRFZLRvxxZxp$"
                  ],
                  "script_queries": [
                    {
                      "script_query": "amp_incidents",
                      "script_query_name": "amp_incidents",
                      "script_query_type": "string"
                    },
                    {
                      "script_query": "drop",
                      "script_query_name": "drop",
                      "script_query_type": "boolean"
                    },
                    {
                      "script_query": "email_text",
                      "script_query_name": "email_text",
                      "script_query_type": "string"
                    }
                  ],
                  "skip_execution": false
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01YYFXFA5WLYW1aZs0vhVPG76gHo1Td3S8t",
                "name": "Condition Block",
                "title": "New incident?",
                "type": "logic.if_else",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "New incident?",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01YYFXFACBCQ40KTOwwQBqVyJgIscbZg96Y",
                    "name": "Condition Branch",
                    "title": "yes",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$activity.definition_activity_01YYFUQXY1YCO18JpE7X0HCQwtxGYoBlxRt.output.script_queries.drop$",
                        "operator": "ne",
                        "right_operand": "true"
                      },
                      "continue_on_failure": false,
                      "display_name": "yes",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01YYG0HTVFR0G574jZLrUIL0lhyf6S7pagw",
                        "name": "Set Variables",
                        "title": "Update email text",
                        "type": "core.set_multiple_variables",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Update email text",
                          "skip_execution": false,
                          "variables_to_update": [
                            {
                              "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$",
                              "variable_value_new": "$activity.definition_activity_01YYFUQXY1YCO18JpE7X0HCQwtxGYoBlxRt.output.script_queries.email_text$"
                            }
                          ]
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01YYG3QACDUSM0ct1UP2nq5uxRscsHrgrf9",
                        "name": "Read Table from JSON",
                        "title": "Read Table from JSON",
                        "type": "corejava.read_table_from_json",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "continue_on_failure": false,
                          "display_name": "Read Table from JSON",
                          "input_json": "$activity.definition_activity_01YYFUQXY1YCO18JpE7X0HCQwtxGYoBlxRt.output.script_queries.amp_incidents$",
                          "jsonpath_query": "$.",
                          "persist_output": false,
                          "populate_columns": false,
                          "skip_execution": false,
                          "table_columns": [
                            {
                              "column_name": "connector_guid",
                              "column_type": "string"
                            },
                            {
                              "column_name": "status",
                              "column_type": "string"
                            },
                            {
                              "column_name": "hostname",
                              "column_type": "string"
                            },
                            {
                              "column_name": "created_at",
                              "column_type": "string"
                            },
                            {
                              "column_name": "updated_at",
                              "column_type": "string"
                            }
                          ]
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya",
                        "name": "For Each",
                        "title": "For Each",
                        "type": "logic.for_each",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "For Each",
                          "skip_execution": false,
                          "source_array": "$activity.definition_activity_01YYG3QACDUSM0ct1UP2nq5uxRscsHrgrf9.output.read_table_from_json$"
                        },
                        "object_type": "definition_activity",
                        "actions": [
                          {
                            "unique_name": "definition_activity_01YYGBE2LUXZ55dLscK5PDU7ef2IqxFzuHT",
                            "name": "HTTP Request",
                            "title": "Get AMP events",
                            "type": "web-service.http_request",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "allow_auto_redirect": true,
                              "allow_headers_redirect": false,
                              "content_type": "application/json",
                              "continue_on_error_status_code": false,
                              "continue_on_failure": false,
                              "display_name": "Get AMP events",
                              "method": "GET",
                              "relative_url": "/events?connector_guid[]=$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].connector_guid$\u0026limit=10\u0026start_date=$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].created_at$",
                              "runtime_user": {
                                "override_target_runtime_user": true,
                                "runtime_user_id": "definition_runtime_user_01YBMEWVFH0Q93mDQfgl3f3oc61RqNywZQg"
                              },
                              "skip_execution": false,
                              "target": {
                                "override_workflow_target": true,
                                "target_id": "definition_target_01YBMDAVR9SDI12rOOMmjJyTyWEVCvr4pOZ"
                              }
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_01YYGOHDPG3NQ320MSRySG6414RX9XgzO13",
                            "name": "Execute Python Script",
                            "title": "Parse AMP events",
                            "type": "python3.script",
                            "base_type": "activity",
                            "properties": {
                              "action_timeout": 180,
                              "continue_on_failure": false,
                              "display_name": "Parse AMP events",
                              "script": "import json\nimport sys\nimport traceback\n\ndef html_list( a_list ):\n    print(f\"html_list({json.dumps(a_list)}\")\n    html = \"\"\n    if len(a_list) == 0:\n        html += \"\u0026nbsp;\"\n    else:\n        if len(a_list) != 1:\n            html += \"\u003cul\u003e\"\n        if type(a_list) is list:\n            for item in a_list:\n                if len(a_list) != 1:\n                    html += \"\u003cli\u003e\"\n                html += f\"{item}\"\n                if len(a_list) != 1:\n                    html += \"\u003c/li\u003e\"\n        elif type(a_list) is dict:\n            for label, item in a_list.items():\n                if len(a_list) != 1:\n                    html += \"\u003cli\u003e\"\n                html += f\"{label}: {item}\"\n                if len(a_list) != 1:\n                    html += \"\u003c/li\u003e\"\n        else:\n            raise Exception(\"Unknow type: \" + str(type(a_list)))\n        if len(a_list) != 1:\n            html += \"\u003c/ul\u003e\"\n\n    return html\n\ndef protect_url( url ):\n    url = url.replace(\"/\", \"/\u003cspan class=\\\"hide_me\\\"\u003e\u0026nbsp;\u003c/span\u003e\")\n    url = url.replace(\"\\\\\", \"\\\\\u003cspan class=\\\"hide_me\\\"\u003e\u0026nbsp;\u003c/span\u003e\")\n    url = url.replace(\".\", \".\u003cspan class=\\\"hide_me\\\"\u003e\u0026nbsp;\u003c/span\u003e\")\n    return url\n\nMAX_EVENTS = 10\n\nemail_text = sys.argv[1]\n\nevents = {}\nevents[\"response\"] = sys.argv[2]\nevents[\"status_code\"] = sys.argv[3]\nevents[\"status_text\"] = sys.argv[4]\n\nstatus = sys.argv[5]\ncrated_at = sys.argv[6]\nupdated_at = sys.argv[7]\nconnector_guid = sys.argv[8]\nhostname = sys.argv[9]\n\ntry:\n    if events[\"status_code\"] != \"200\":\n        raise Exception(\"HTML Error!\")\n\n    response = json.loads(events[\"response\"])\n\n    if \"data\" not in response:\n        raise Exception(\"No data!\")\n\n    response = response[\"data\"]\n\n    if len(response) \u003e 0:\n\n        network_addresses = []\n\n        for riga in response:\n            if (\"computer\" in riga) and (\"network_addresses\" in riga[\"computer\"]):\n                for network_address in riga[\"computer\"][\"network_addresses\"]:\n                    if (\"ip\" in network_address) and (network_address[\"ip\"] not in network_addresses):\n                        network_addresses.append(network_address[\"ip\"])\n\n        email_text += f\"\u003ch2\u003e New Incident for the Host {hostname}\u003c/h2\u003e\"\n\n        email_text += \"\u003ctable\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003estatus\u003c/th\u003e\u003ctd\u003e{status}\u003c/td\u003e\u003c/tr\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003ecrated_at\u003c/th\u003e\u003ctd\u003e{crated_at}\u003c/td\u003e\u003c/tr\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003eupdated_at\u003c/th\u003e\u003ctd\u003e{updated_at}\u003c/td\u003e\u003c/tr\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003econnector_guid\u003c/th\u003e\u003ctd\u003e{connector_guid}\u003c/td\u003e\u003c/tr\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003eDevice Trajectory\u003c/th\u003e\u003ctd\u003ehttps://console.eu.amp.cisco.com/computers/{connector_guid}/trajectory2\u003c/tr\u003e\"\n        email_text += f\"\u003ctr\u003e\u003cth\u003enetwork_addresses\u003c/th\u003e\u003ctd\u003e{html_list(network_addresses)}\u003c/td\u003e\u003c/tr\u003e\"\n        email_text += \"\u003c/table\u003e\"\n\n        email_text += f\"\u003cp\u003eBelow the latest {MAX_EVENTS} events detected on the Compromised Host:\u003c/p\u003e\"\n\n        email_text += \"\u003ctable\u003e\"\n        email_text += \"\u003ctr\u003e\u003cth\u003edate\u003c/th\u003e\u003cth\u003eevent_type\u003c/th\u003e\u003cth\u003efile\u003c/th\u003e\u003cth\u003eerror\u003c/th\u003e\u003c/tr\u003e\"\n        for riga in response:\n            email_text += \"\u003ctr\u003e\"\n\n            if \"date\" in riga:\n                email_text += f\"\u003ctd\u003e{riga['date']}\u003c/td\u003e\"\n            else:\n                email_text += \"\u003ctd\u003e\u0026nbsp;\u003c/td\u003e\"\n\n            if \"event_type\" in riga:\n                email_text += f\"\u003ctd\u003e{riga['event_type']}\u003c/td\u003e\"\n            else:\n                email_text += \"\u003ctd\u003e\u0026nbsp;\u003c/td\u003e\"\n\n            file_details = {}\n\n            if \"file\" in riga:\n                if \"file_path\" in riga[\"file\"]:\n                    file_details[\"file_path\"] = protect_url(riga[\"file\"][\"file_path\"])\n                if (\"identity\" in riga[\"file\"]) and (\"sha256\" in riga[\"file\"][\"identity\"]):\n                    file_details[\"sha256\"] = riga['file']['identity']['sha256']\n                if len(file_details) == 0:\n                    file_details[\"json\"] = json.dumps(riga['file'])\n\n            email_text += f\"\u003ctd\u003e{html_list(file_details)}\u003c/td\u003e\"\n\n            if \"error\" in riga:\n                if \"description\" in riga['error']:\n                    email_text += f\"\u003ctd\u003e{riga['error']['description']}\u003c/td\u003e\"\n                else:\n                    email_text += f\"\u003ctd\u003e{json.dumps(riga['error'])}\u003c/td\u003e\"\n            else:\n                email_text += \"\u003ctd\u003e\u0026nbsp;\u003c/td\u003e\"\n\n            email_text += \"\u003c/tr\u003e\"\n        email_text += \"\u003c/table\u003e\"\n\nexcept Exception as Err:\n    email_text = \"\u003ch1\u003eAPI AMP ERROR\u003c/h1\u003e\"\n    email_text += f\"\u003cp\u003e{traceback.format_exc()}\u003c/p\u003e\"\n    email_text += \"\u003cp\u003e\"\n\n    for key, value in events.items():\n        email_text += f\"{key}: {json.dumps(value)}\u003cbr\u003e\"\n\n        email_text += \"\u003c/p\u003e\"\n        print( email_text )\n        raise Err",
                              "script_arguments": [
                                "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$",
                                "$activity.definition_activity_01YYGBE2LUXZ55dLscK5PDU7ef2IqxFzuHT.output.response_body$",
                                "$activity.definition_activity_01YYGBE2LUXZ55dLscK5PDU7ef2IqxFzuHT.output.status_code$",
                                "$activity.definition_activity_01YYGBE2LUXZ55dLscK5PDU7ef2IqxFzuHT.output.status_text$",
                                "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].status$",
                                "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].created_at$",
                                "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].updated_at$",
                                "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].connector_guid$",
                                "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].hostname$"
                              ],
                              "script_queries": [
                                {
                                  "script_query": "email_text",
                                  "script_query_name": "email_text",
                                  "script_query_type": "string"
                                }
                              ],
                              "skip_execution": false
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_01YYGTFVNN8F93m3gWnC7cDX9NvIbk6Dcl8",
                            "name": "Set Variables",
                            "title": "Update email text",
                            "type": "core.set_multiple_variables",
                            "base_type": "activity",
                            "properties": {
                              "continue_on_failure": false,
                              "display_name": "Update email text",
                              "skip_execution": false,
                              "variables_to_update": [
                                {
                                  "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$",
                                  "variable_value_new": "$activity.definition_activity_01YYGOHDPG3NQ320MSRySG6414RX9XgzO13.output.script_queries.email_text$"
                                }
                              ]
                            },
                            "object_type": "definition_activity"
                          },
                          {
                            "unique_name": "definition_activity_0229V8YCJ48AK1EJWEcVChUNm36VmIRsSOM",
                            "name": "Set Variables",
                            "title": "Set Hostname",
                            "type": "core.set_multiple_variables",
                            "base_type": "activity",
                            "properties": {
                              "continue_on_failure": false,
                              "display_name": "Set Hostname",
                              "skip_execution": false,
                              "variables_to_update": [
                                {
                                  "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0229V8TOPM4FR1lGAXmKNMZnYGiw9U5MOmI$",
                                  "variable_value_new": "$activity.definition_activity_01YYG5Q3PEWNL5tIN503l123oUVMlduNVya.input.source_array[@].hostname$"
                                }
                              ]
                            },
                            "object_type": "definition_activity"
                          }
                        ]
                      },
                      {
                        "unique_name": "definition_activity_01YYJWUI2YIAR7XGGtz1ffCiVgSI8sldtTE",
                        "name": "Set Variables",
                        "title": "Update email text",
                        "type": "core.set_multiple_variables",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Update email text",
                          "skip_execution": false,
                          "variables_to_update": [
                            {
                              "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$",
                              "variable_value_new": "\u003ch1\u003eSecure Endpoint - Compromise Detected\u003c/h1\u003e\n\n$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$"
                            }
                          ]
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_0205WKULFLJWP6CEOrE9HxZxX6sNLTrBhHG",
                        "name": "Send Email",
                        "title": "Send Email",
                        "type": "email.smtp_send_email",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "body": "\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle\u003e\n      table, th, td {\n        border: 1px solid;\n        border-collapse: collapse;\n      }\n      th, td {\n        padding: 0.5em;\n        padding-left: 0.5em;\n        padding-right: 0.5em;\n        white-space: nowrap;\n      }\n      ul {\n         margin-bottom: 0px;\n      }\n      .hide_me {\n        display: none;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFZA82SZ110pzTztVkZ4aF9PzNgWxHJT$\n$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFAYZF69NA2jO5cHtX5h0RZWLfaVAnTV$\n  \u003c/body\u003e\n\u003c/html\u003e",
                          "continue_if_one_address_valid": false,
                          "continue_on_failure": false,
                          "display_name": "Send Email",
                          "html": true,
                          "runtime_user": {
                            "target_default": true
                          },
                          "skip_execution": false,
                          "subject": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0229V8TOPM4FR1lGAXmKNMZnYGiw9U5MOmI$ - New Compromise detected",
                          "target": {
                            "override_workflow_target": true,
                            "target_id": "definition_target_01Z3KA3ALZPQ35rHnpB72C3ayzvjLnUmUKs"
                          },
                          "to": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_020BZIBRUUYV75gUcAktqDbOTeEiTCVCm1b$"
                        },
                        "object_type": "definition_activity"
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "unique_name": "definition_activity_01YYEDB4EUMEC6j8Hf8bKJ3eaH43QXCV3vq",
            "name": "Parallel Branch",
            "title": "Umbrella branch",
            "type": "logic.parallel_block",
            "base_type": "activity",
            "properties": {
              "continue_on_failure": false,
              "display_name": "Umbrella branch",
              "skip_execution": true
            },
            "object_type": "definition_activity",
            "actions": [
              {
                "unique_name": "definition_activity_01YXPZ8HI5ROS0tI9D2xuAbBcnZ4GBcAW1l",
                "name": "HTTP Request",
                "title": "Request barer token",
                "type": "web-service.http_request",
                "base_type": "activity",
                "properties": {
                  "action_timeout": 180,
                  "allow_auto_redirect": true,
                  "allow_headers_redirect": false,
                  "continue_on_error_status_code": false,
                  "continue_on_failure": false,
                  "custom_headers": [
                    {
                      "name": "X-Umbrella-OrgID",
                      "value": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YXQ7HY2JZMO0ekSqQH4DKBWPZ6HCyIFwi$"
                    }
                  ],
                  "display_name": "Request barer token",
                  "method": "POST",
                  "relative_url": "/auth/v2/oauth2/token",
                  "runtime_user": {
                    "override_target_runtime_user": true,
                    "runtime_user_id": "definition_runtime_user_01YXPY066OQK95DrKOJ8v9j1ghAC2sbDRHl"
                  },
                  "skip_execution": false,
                  "target": {
                    "override_workflow_target": true,
                    "target_id": "definition_target_01YXQ346QVGEJ0b2nCpuqwGloAmnNeqPKsZ"
                  }
                },
                "object_type": "definition_activity"
              },
              {
                "unique_name": "definition_activity_01YYERYIYSXOQ3Qu0XUyGg5HpbZThzq5R2d",
                "name": "Condition Block",
                "title": "Valid Token?",
                "type": "logic.if_else",
                "base_type": "activity",
                "properties": {
                  "continue_on_failure": false,
                  "display_name": "Valid Token?",
                  "skip_execution": false
                },
                "object_type": "definition_activity",
                "blocks": [
                  {
                    "unique_name": "definition_activity_01YYERYJ58TUN6bvbaZxc0XewFlZXLTNCZ1",
                    "name": "Condition Branch",
                    "title": "Yes",
                    "type": "logic.condition_block",
                    "base_type": "activity",
                    "properties": {
                      "condition": {
                        "left_operand": "$activity.definition_activity_01YXPZ8HI5ROS0tI9D2xuAbBcnZ4GBcAW1l.output.status_code$",
                        "operator": "eq",
                        "right_operand": 200
                      },
                      "continue_on_failure": false,
                      "display_name": "Yes",
                      "skip_execution": false
                    },
                    "object_type": "definition_activity",
                    "actions": [
                      {
                        "unique_name": "definition_activity_01YXQBPC02BEX2fNITeVpW8y2LXHIpEJbwy",
                        "name": "JSONPath Query",
                        "title": "Extract barer token",
                        "type": "corejava.jsonpathquery",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "continue_on_failure": false,
                          "display_name": "Extract barer token",
                          "input_json": "$activity.definition_activity_01YXPZ8HI5ROS0tI9D2xuAbBcnZ4GBcAW1l.output.response_body$",
                          "jsonpath_queries": [
                            {
                              "jsonpath_query": "$.access_token",
                              "jsonpath_query_name": "access_token",
                              "jsonpath_query_type": "string"
                            }
                          ],
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01YXQJEGOLH307Z0xAJEVGygFD2SAxe9qjo",
                        "name": "HTTP Request",
                        "title": "Request activity",
                        "type": "web-service.http_request",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "allow_auto_redirect": true,
                          "allow_headers_redirect": false,
                          "content_type": "application/json",
                          "continue_on_error_status_code": false,
                          "continue_on_failure": false,
                          "custom_headers": [
                            {
                              "name": "Authorization",
                              "value": "Bearer $activity.definition_activity_01YXQBPC02BEX2fNITeVpW8y2LXHIpEJbwy.output.jsonpath_queries.access_token$"
                            }
                          ],
                          "display_name": "Request activity",
                          "method": "GET",
                          "relative_url": "/organizations/$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YXQ7HY2JZMO0ekSqQH4DKBWPZ6HCyIFwi$/activity?from=-10minutes\u0026to=now\u0026limit=1000\u0026offset=0\u0026categories=64%2C65%2C66%2C67%2C150",
                          "runtime_user": {
                            "target_default": true
                          },
                          "skip_execution": false,
                          "target": {
                            "override_workflow_target": true,
                            "target_id": "definition_target_01PUFC9QNX0T46RaoGWwNqpV6DaZOEmYcYT"
                          }
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_0205W0TOP47N83PZDtwwsryE0hQJVBBOXq4",
                        "name": "Execute Python Script",
                        "title": "Extract domains",
                        "type": "python3.script",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "continue_on_failure": false,
                          "display_name": "Extract domains",
                          "script": "import sys\nimport json\n\nstatus_code = int(sys.argv[2])\ndomains = []\n\nif status_code == 200:\n  data = json.loads(sys.argv[1])\n  data = data[\"data\"]\n\n  for raw in data:\n    raw[\"domain\"] = raw[\"domain\"].lower()\n    if raw[\"domain\"] not in domains:\n      domains.append(raw[\"domain\"])\n\ndomains = json.dumps(domains)",
                          "script_arguments": [
                            "$activity.definition_activity_01YXQJEGOLH307Z0xAJEVGygFD2SAxe9qjo.output.response_body$",
                            "$activity.definition_activity_01YXQJEGOLH307Z0xAJEVGygFD2SAxe9qjo.output.status_code$"
                          ],
                          "script_queries": [
                            {
                              "script_query": "domains",
                              "script_query_name": "domains",
                              "script_query_type": "string"
                            }
                          ],
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_0205W37PMG6NI5GUtnyQImME1W0dcxdAsj7",
                        "name": "Split String",
                        "title": "Generate domain list",
                        "type": "core.splitstring",
                        "base_type": "activity",
                        "properties": {
                          "boundaries": [
                            {
                              "boundary": "["
                            },
                            {
                              "boundary": "\""
                            },
                            {
                              "boundary": ","
                            },
                            {
                              "boundary": "]"
                            }
                          ],
                          "continue_on_failure": false,
                          "display_name": "Generate domain list",
                          "input_string": "$activity.definition_activity_0205W0TOP47N83PZDtwwsryE0hQJVBBOXq4.output.script_queries.domains$",
                          "remove_empty": true,
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_0205W4DCFB7S06jwKb5LbamlNlR3WNuC9Sk",
                        "name": "Condition Block",
                        "title": "we have a domain list?",
                        "type": "logic.if_else",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "we have a domain list?",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "blocks": [
                          {
                            "unique_name": "definition_activity_0205W4DD1LW1P0AznWltcpMtc29gFCpjMiC",
                            "name": "Condition Branch",
                            "title": "yes",
                            "type": "logic.condition_block",
                            "base_type": "activity",
                            "properties": {
                              "condition": {
                                "left_operand": "$activity.definition_activity_0205W0TOP47N83PZDtwwsryE0hQJVBBOXq4.output.script_queries.domains$",
                                "operator": "ne",
                                "right_operand": "[]"
                              },
                              "continue_on_failure": false,
                              "display_name": "yes",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "actions": [
                              {
                                "unique_name": "definition_activity_0205W6S7UCNZP3LlC1yIbWUxqSmVyiCr3zq",
                                "name": "For Each",
                                "title": "for each domain",
                                "type": "logic.for_each",
                                "base_type": "activity",
                                "properties": {
                                  "continue_on_failure": false,
                                  "display_name": "for each domain",
                                  "skip_execution": false,
                                  "source_array": "$activity.definition_activity_0205W37PMG6NI5GUtnyQImME1W0dcxdAsj7.output.parts$"
                                },
                                "object_type": "definition_activity",
                                "actions": [
                                  {
                                    "unique_name": "definition_activity_0205W5SQPQ7AD68ttOfcgTayWDfT121vsBh",
                                    "name": "check domain reputation",
                                    "title": "check domain reputation",
                                    "type": "workflow.atomic_workflow",
                                    "base_type": "subworkflow",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "check domain reputation",
                                      "input": {
                                        "variable_workflow_01ZZWU05PITQL3CIv0PeWotMFJvm4vnqlPp": "$global.variable_0205W9SLK3A9K1yswSM8HiaLGil33vDk3wB.global.variable_0205W9SLK3A9K1yswSM8HiaLGil33vDk3wB$",
                                        "variable_workflow_01ZZWU05PJ49X3nWp0CJgDE5ZLXiDBQNH2r": "$activity.definition_activity_0205W6S7UCNZP3LlC1yIbWUxqSmVyiCr3zq.input.source_array[@]$"
                                      },
                                      "runtime_user": {
                                        "target_default": true
                                      },
                                      "skip_execution": false,
                                      "target": {
                                        "override_workflow_target": true,
                                        "target_id": "definition_target_0205VTL02TTQ26g7O9ZNA8u2HV9R25XIIQn",
                                        "target_type": "web-service.endpoint"
                                      },
                                      "workflow_id": "definition_workflow_01ZZWU05GYF543KNmHsJwVJZZDPu4L8OueC",
                                      "workflow_name": "[SISPI] VirusTotal Domains Reputation"
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_0205WBIU8U1TB2XwWmt6eKPzTCAfsefePwx",
                                    "name": "Execute Python Script",
                                    "title": "update domain reputation",
                                    "type": "python3.script",
                                    "base_type": "activity",
                                    "properties": {
                                      "action_timeout": 180,
                                      "continue_on_failure": false,
                                      "display_name": "update domain reputation",
                                      "script": "import sys\nimport json\nimport traceback\n\ndomain_reputations = {}\n\ntry:\n  if len(sys.argv[1]) \u003e 0:\n    domain_reputations = json.loads(sys.argv[1])\n  domain_reputations[sys.argv[2]] = sys.argv[3]\n\nexcept Exception as Err:\n  ErrorMsg = \"\"\n  ErrorMsg += traceback.format_exc() + \"\\n\"\n  ErrorMsg += \"\\n\"\n  ErrorMsg += str(Err)\n\n  raise Exception(ErrorMsg)\n\ndomain_reputations = json.dumps(domain_reputations)",
                                      "script_arguments": [
                                        "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0205WCM30BPN319iQJRIG5bdiMeLhZyAwGp$",
                                        "$activity.definition_activity_0205W6S7UCNZP3LlC1yIbWUxqSmVyiCr3zq.input.source_array[@]$",
                                        "$activity.definition_activity_0205W5SQPQ7AD68ttOfcgTayWDfT121vsBh.output.variable_workflow_01ZZWU05PJCO52VGpvtZWVcJW0vIBBVnclZ$"
                                      ],
                                      "script_queries": [
                                        {
                                          "script_query": "domain_reputations",
                                          "script_query_name": "domain_reputations",
                                          "script_query_type": "string"
                                        }
                                      ],
                                      "skip_execution": false
                                    },
                                    "object_type": "definition_activity"
                                  },
                                  {
                                    "unique_name": "definition_activity_0205WFIP3LWSQ1mtfHXyr5maoe6rukKenzV",
                                    "name": "Set Variables",
                                    "title": "save domain reputation",
                                    "type": "core.set_multiple_variables",
                                    "base_type": "activity",
                                    "properties": {
                                      "continue_on_failure": false,
                                      "display_name": "save domain reputation",
                                      "skip_execution": false,
                                      "variables_to_update": [
                                        {
                                          "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0205WCM30BPN319iQJRIG5bdiMeLhZyAwGp$",
                                          "variable_value_new": "$activity.definition_activity_0205WBIU8U1TB2XwWmt6eKPzTCAfsefePwx.output.script_queries.domain_reputations$"
                                        }
                                      ]
                                    },
                                    "object_type": "definition_activity"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "unique_name": "definition_activity_01YXSHTKNQ8GV61dhD51K9kJg6gJdbM5Tl2",
                        "name": "Execute Python Script",
                        "title": "Generate Umbrella report",
                        "type": "python3.script",
                        "base_type": "activity",
                        "properties": {
                          "action_timeout": 180,
                          "continue_on_failure": false,
                          "display_name": "Generate Umbrella report",
                          "script": "import sys\nimport json\nimport datetime\n\ndomain_whitelist = [\n  \"123w0w.com\"\n]\n\ndef timestamp_to_str(timestamp):\n  timestamp = datetime.datetime.fromtimestamp((int(timestamp))+3600*2).strftime('%Y-%m-%d %H:%M:%S')\n\n  return timestamp\n\ndef escape_domain( domain ):\n  return domain.replace(\".\",\" \")\n\ndef domain_reputation_to_html( dr ):\n  dr = json.loads( dr )\n  html = \"\"\n\n  if \"date\" in dr:\n    dr[\"date\"] = timestamp_to_str(dr[\"date\"])\n\n  if len(dr) \u003e 0:\n    for k, v in dr.items():\n      html += f\"\u003cdiv\u003e\u003cb\u003e{k}:\u003c/b\u003e {v}\u003c/div\u003e\"\n\n  return html\n    \n\ndef parse_categories( categories ):\n  n = len( categories )\n\n  result = \"\"\n  if n == 1:\n    result += categories[0][\"label\"]\n  elif n \u003e 1:\n    result += \"\u003cul\u003e\"\n    for category in categories:\n      result += \"\u003cli\u003e\" + category[\"label\"] + \"\u003c/li\u003e\"\n    result += \"\u003c/ul\u003e\"\n  return result\n\nstatus_code = int(sys.argv[2])\nhtml = \"\"\ntable = \"\"\nif len(sys.argv[3]) \u003e 0:\n  domain_reputations = json.loads(sys.argv[3])\nelse:\n  domain_reputations = {}\n\nif status_code == 200:\n  data = json.loads(sys.argv[1])\n  data = data[\"data\"]\n\n  print(json.dumps(data))\n\n  for raw in data:\n    domain = raw[\"domain\"].lower()\n    tablerow = \"\u003ctr\u003e\"\n    tablerow += \"\u003ctd\u003e\" + raw[\"type\"] + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + escape_domain( domain ) + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + raw[\"internalip\"] + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + raw[\"externalip\"] + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + raw[\"verdict\"] + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + parse_categories(raw[\"categories\"]) + \"\u003c/td\u003e\"\n    tablerow += \"\u003ctd\u003e\" + raw[\"date\"] + \" \" + raw[\"time\"] + \"\u003c/td\u003e\"\n    if domain in domain_reputations:\n      tablerow += \"\u003ctd\u003e\" + domain_reputation_to_html( domain_reputations[domain] ) +  \"\u003c/td\u003e\"\n    else:\n      tablerow += \"\u003ctd\u003e\u0026nbsp;\u003c/td\u003e\"\n    tablerow += \"\u003c/tr\u003e\\n\"\n\n    if domain not in domain_whitelist:\n      table += tablerow\n\nif table != \"\":\n  table_head = \"\u003ctable\u003e\\n\"\n  table_head += \"\u003ctr\u003e\"\n  table_head += \"\u003cth\u003eRequest\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eDestination\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eSource\u003cbr /\u003eInternal IP\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eSource\u003cbr /\u003eExternal IP\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eAction\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eCategories\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eDate \u0026 Time\u003c/th\u003e\"\n  table_head += \"\u003cth\u003eDomain reputation\u003c/th\u003e\"\n  table_head += \"\u003c/tr\u003e\\n\"\n\n  table_foot = \"\u003c/table\u003e\\n\"\n\n  html = \"\u003ch1\u003eIncidenti Umbrella\u003c/h1\u003e\\n\" \n  html += \"\u003cp\u003eDi seguito gli ultimi eventi proveniente da umbrella:\u003c/p\u003e\\n\"\n  html += table_head + table + table_foot\n\numbrella_report = html",
                          "script_arguments": [
                            "$activity.definition_activity_01YXQJEGOLH307Z0xAJEVGygFD2SAxe9qjo.output.response_body$",
                            "$activity.definition_activity_01YXQJEGOLH307Z0xAJEVGygFD2SAxe9qjo.output.status_code$",
                            "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_0205WCM30BPN319iQJRIG5bdiMeLhZyAwGp$"
                          ],
                          "script_queries": [
                            {
                              "script_query": "umbrella_report",
                              "script_query_name": "umbrella_report",
                              "script_query_type": "string"
                            }
                          ],
                          "skip_execution": false
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01YYFBF9V08TA2mopPA8QrwkS7N9rN6Tddj",
                        "name": "Set Variables",
                        "title": "Update email text",
                        "type": "core.set_multiple_variables",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "Update email text",
                          "skip_execution": false,
                          "variables_to_update": [
                            {
                              "variable_to_update": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFAYZF69NA2jO5cHtX5h0RZWLfaVAnTV$",
                              "variable_value_new": "$activity.definition_activity_01YXSHTKNQ8GV61dhD51K9kJg6gJdbM5Tl2.output.script_queries.umbrella_report$"
                            }
                          ]
                        },
                        "object_type": "definition_activity"
                      },
                      {
                        "unique_name": "definition_activity_01YYFE2QJ8K3V6CtpEVzDgEAP85Yiuw10SF",
                        "name": "Condition Block",
                        "title": "New incident?",
                        "type": "logic.if_else",
                        "base_type": "activity",
                        "properties": {
                          "continue_on_failure": false,
                          "display_name": "New incident?",
                          "skip_execution": false
                        },
                        "object_type": "definition_activity",
                        "blocks": [
                          {
                            "unique_name": "definition_activity_01YYFE2QOWNUB4rOUw89gMbSi9lTg672JLp",
                            "name": "Condition Branch",
                            "title": "yes",
                            "type": "logic.condition_block",
                            "base_type": "activity",
                            "properties": {
                              "condition": {
                                "left_operand": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFAYZF69NA2jO5cHtX5h0RZWLfaVAnTV$",
                                "operator": "ne",
                                "right_operand": ""
                              },
                              "continue_on_failure": false,
                              "display_name": "yes",
                              "skip_execution": false
                            },
                            "object_type": "definition_activity",
                            "actions": [
                              {
                                "unique_name": "definition_activity_01YYFEYDOYRLB0Tn2iqHBQlDgRVqW5IgiNt",
                                "name": "Send Email",
                                "title": "Send Email",
                                "type": "email.smtp_send_email",
                                "base_type": "activity",
                                "properties": {
                                  "action_timeout": 180,
                                  "body": "\u003chtml\u003e\n  \u003chead\u003e\n    \u003cstyle\u003e\n      table, th, td {\n        border: 1px solid;\n        border-collapse: collapse;\n      }\n      th, td {\n        padding: 0.5em;\n        padding-left: 0.5em;\n        padding-right: 0.5em;\n        white-space: nowrap;\n      }\n      ul {\n         margin-bottom: 0px;\n      }\n      .hide_me {\n        display: none;\n      }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_01YYFAYZF69NA2jO5cHtX5h0RZWLfaVAnTV$\n  \u003c/body\u003e\n\u003c/html\u003e",
                                  "cc": "$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.0229U7OK0MNJF66JEdAzTAewnUmBWvJx9DH$\n$workflow.definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK.local.variable_workflow_020BZIBRUUYV75gUcAktqDbOTeEiTCVCm1b$",
                                  "continue_if_one_address_valid": false,
                                  "continue_on_failure": false,
                                  "display_name": "Send Email",
                                  "html": true,
                                  "runtime_user": {
                                    "target_default": true
                                  },
                                  "skip_execution": false,
                                  "subject": "[SISPI] Notifica nuovi incidenti Umbrella",
                                  "target": {
                                    "override_workflow_target": true,
                                    "target_id": "definition_target_01Y0LXHTSP8RL3SgqYvHF4SGyENYfuhBb38"
                                  },
                                  "to": "soc@axians.it"
                                },
                                "object_type": "definition_activity"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ],
    "categories": [
      "category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"
    ]
  },
  "triggers": {
    "triggerschedule_01YYI5CGGWH6U56zZ9G7yWhaeUqHk87KIMi": {
      "workflow_id": "definition_workflow_01YXPY737S4QE6XESNNjsXu2fAs5ts0TjaK",
      "name": "Every 5 minutes trigger",
      "title": "",
      "lowercase_name": "schedule.every_5_minutes_trigger",
      "type": "schedule",
      "base_type": "trigger",
      "ref_id": "schedule_01YFYY5O6BYVO0u3FMNiFmHvdauXpydSdwM",
      "version": "",
      "disabled": false,
      "unique_name": "triggerschedule_01YYI5CGGWH6U56zZ9G7yWhaeUqHk87KIMi",
      "object_type": "triggerschedule"
    }
  },
  "schedules": {
    "schedule_01YFYY5O6BYVO0u3FMNiFmHvdauXpydSdwM": {
      "unique_name": "schedule_01YFYY5O6BYVO0u3FMNiFmHvdauXpydSdwM",
      "name": "Every 5 Minute",
      "type": "basic.schedule",
      "base_type": "schedule",
      "properties": {
        "calendar": "calendar_recurring_1BMfMWvgiDhSjBQ7hTSyvz3NyVZ",
        "timezone": "Europe/Brussels",
        "starttime": "00:00",
        "interval_hours": 0,
        "interval_minutes": 5,
        "number_of_times": 288,
        "display_name": "Every 5 Minute",
        "description": ""
      },
      "version": "1.0.0",
      "object_type": "schedule"
    }
  },
  "targets": {
    "definition_target_01PUFC9QNX0T46RaoGWwNqpV6DaZOEmYcYT": {
      "unique_name": "definition_target_01PUFC9QNX0T46RaoGWwNqpV6DaZOEmYcYT",
      "name": "Umbrella Reporting API v2",
      "title": "Umbrella Reporting API v2",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": false,
        "display_name": "Umbrella Reporting API v2",
        "host": "api.us.reports.umbrella.com",
        "ignore_proxy": true,
        "no_runtime_user": true,
        "protocol": "https"
      }
    },
    "definition_target_01Y0LXHTSP8RL3SgqYvHF4SGyENYfuhBb38": {
      "unique_name": "definition_target_01Y0LXHTSP8RL3SgqYvHF4SGyENYfuhBb38",
      "name": "Phishing Investigation Outgoing",
      "title": "Phishing Investigation Outgoing",
      "type": "email.smtp_endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "default_runtime_user_id": "definition_runtime_user_01Y0LRPG9Z9T12MXcl2B9re5WlX5UNBLxVE",
        "display_name": "Phishing Investigation Outgoing",
        "no_runtime_user": false,
        "port": 587,
        "protocol": "SMTP",
        "server": "smtp.gmail.com"
      }
    },
    "definition_target_01YBMDAVR9SDI12rOOMmjJyTyWEVCvr4pOZ": {
      "unique_name": "definition_target_01YBMDAVR9SDI12rOOMmjJyTyWEVCvr4pOZ",
      "name": "Secure Endpoint Target",
      "title": "Secure Endpoint Target",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "default_runtime_user_id": "definition_runtime_user_01YBMEWVFH0Q93mDQfgl3f3oc61RqNywZQg",
        "disable_certificate_validation": false,
        "display_name": "Secure Endpoint Target",
        "host": "api.eu.amp.cisco.com",
        "ignore_proxy": false,
        "no_runtime_user": false,
        "path": "/v1",
        "protocol": "https"
      }
    },
    "definition_target_01YXQ346QVGEJ0b2nCpuqwGloAmnNeqPKsZ": {
      "unique_name": "definition_target_01YXQ346QVGEJ0b2nCpuqwGloAmnNeqPKsZ",
      "name": "Umbrella Management API",
      "title": "Umbrella Management API",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": false,
        "display_name": "Umbrella Management API",
        "host": "management.api.umbrella.com",
        "ignore_proxy": true,
        "no_runtime_user": true,
        "path": "/",
        "protocol": "https"
      }
    },
    "definition_target_01Z3KA3ALZPQ35rHnpB72C3ayzvjLnUmUKs": {
      "unique_name": "definition_target_01Z3KA3ALZPQ35rHnpB72C3ayzvjLnUmUKs",
      "name": "SecureEndpointSmtp",
      "title": "SecureEndpointSmtp",
      "type": "email.smtp_endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "default_runtime_user_id": "definition_runtime_user_01Z3K96JTZ54D77n0PQpgVJJU9XBVnwktaO",
        "display_name": "SecureEndpointSmtp",
        "no_runtime_user": false,
        "port": 587,
        "protocol": "SMTP",
        "server": "smtp.office365.com"
      }
    },
    "definition_target_0205VTL02TTQ26g7O9ZNA8u2HV9R25XIIQn": {
      "unique_name": "definition_target_0205VTL02TTQ26g7O9ZNA8u2HV9R25XIIQn",
      "name": "VirusTotal v3 API",
      "title": "VirusTotal v3 API",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": false,
        "display_name": "VirusTotal v3 API",
        "host": "www.virustotal.com",
        "ignore_proxy": true,
        "no_runtime_user": true,
        "path": "/api/v3/",
        "protocol": "https"
      }
    }
  },
  "runtime_users": {
    "definition_runtime_user_01Y0LRPG9Z9T12MXcl2B9re5WlX5UNBLxVE": {
      "unique_name": "definition_runtime_user_01Y0LRPG9Z9T12MXcl2B9re5WlX5UNBLxVE",
      "name": "Phishing Investigation Mailbox Credentials",
      "title": "Phishing Investigation Mailbox Credentials",
      "type": "runtime_user.email_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "display_name": "Phishing Investigation Mailbox Credentials",
        "password": "*****",
        "sender": "pfiano@scuolaitalianabarcellona.it"
      }
    },
    "definition_runtime_user_01YBMEWVFH0Q93mDQfgl3f3oc61RqNywZQg": {
      "unique_name": "definition_runtime_user_01YBMEWVFH0Q93mDQfgl3f3oc61RqNywZQg",
      "name": "Secure Endpoint Beeri API Key",
      "title": "Secure Endpoint Beeri API Key",
      "type": "runtime_user.web-service_basic_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "auth_option": "Basic",
        "basic_password": "*****",
        "basic_username": "803fe78c7d76fb0a0a09",
        "display_name": "Secure Endpoint Beeri API Key"
      }
    },
    "definition_runtime_user_01YXPY066OQK95DrKOJ8v9j1ghAC2sbDRHl": {
      "unique_name": "definition_runtime_user_01YXPY066OQK95DrKOJ8v9j1ghAC2sbDRHl",
      "name": "Umbrella reporting APIKEY",
      "title": "Umbrella reporting APIKEY",
      "type": "runtime_user.web-service_basic_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "auth_option": "Basic",
        "basic_password": "*****",
        "basic_username": "e573a6ec89a8417280f732510670d4e4",
        "display_name": "Umbrella reporting APIKEY"
      }
    },
    "definition_runtime_user_01Z3K96JTZ54D77n0PQpgVJJU9XBVnwktaO": {
      "unique_name": "definition_runtime_user_01Z3K96JTZ54D77n0PQpgVJJU9XBVnwktaO",
      "name": "EndpointMail",
      "title": "EndpointMail",
      "type": "runtime_user.email_credentials",
      "base_type": "runtime_user",
      "object_type": "definition_runtime_user",
      "properties": {
        "description": "Send compromises of endpoints",
        "display_name": "EndpointMail",
        "password": "*****",
        "sender": "endpoint-report@beeriprint.co.il"
      }
    }
  },
  "variables": {
    "variable_0205W9SLK3A9K1yswSM8HiaLGil33vDk3wB": {
      "unique_name": "variable_0205W9SLK3A9K1yswSM8HiaLGil33vDk3wB",
      "properties": {
        "value": "124872dd39a5fb54cb8be2dee7dc8ae93ae87f06699b9818dc8e5a50a5285ff8",
        "scope": "global",
        "name": "VirusTotal API key",
        "type": "datatype.string",
        "description": "API Key di Roger Adonai MAINI",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    }
  },
  "atomic_workflows": [
    "definition_workflow_01ZZWU05GYF543KNmHsJwVJZZDPu4L8OueC"
  ],
  "dependent_workflows": [
    "definition_workflow_01ZZWU05GYF543KNmHsJwVJZZDPu4L8OueC"
  ]
}